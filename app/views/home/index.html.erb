<% title "Knoda | Predict • Compete • Conquer" %>
<div class="row" style="background-color: white; padding: 0px 40px;">       
  <div class="col-xs-12 col-sm-8 col-sm-offset-2 col-md-6 col-md-offset-3 col-lg-4 col-lg-offset-4" style="padding-top:30px;padding-bottom: 30px">
      <h1>Know the future? <span style="font-weight:700">Prove it.</span></h3>
      <h3>Knoda lets you predict anything, challenge your friends, and talk some trash.  Make your prediction today.</h3>
      <%= form_for(resource, :as => resource_name, :url => registration_path(resource_name)) do |f| %>
        <div class="alert alert-danger" style="display:none">
          <p>Hold on, your registration isn't ready yet.</p>
          <ul style="padding-left:30px">
          </ul>
        </div>
        <div class="form-group">
          <%= f.email_field :email, :class => 'form-control input-lg', :placeholder => 'email', :maxlength => '255' %>
        </div>
        <div class="form-group">
          <%= f.text_field :username, :class => 'form-control input-lg', :placeholder => 'username', :maxlength => '15'%>
        </div>
        <div class="form-group">
          <%= f.password_field :password, :class => 'form-control input-lg', :placeholder => 'password', :maxlength => '50' %>
        </div>
        <%= f.submit :class => 'hidden-xs hidden-sm hidden-md hidden-lg' %>
        <div>
          <button type="submit" class="btn btn-link signup">Sign Up <%= image_tag('icons/sd/login_arrow.png') %></a>
        </div>
        <a href="#" class="login pull-right" data-toggle="modal" data-target="#loginModal">Already a Knoda user? Login</a>
      <% end %>       
  </div>
</div> 
<div class="row">
  <div class="col-md-5 col-md-offset-1 col-sm-12 col-xs-12 hidden-sm hidden-xs  " style="text-align:right;">
    <%= image_tag("app_mockups.png", :style => 'height: 350px;margin-top: 25px;margin-right:15%') %>
  </div>
  <div class="col-md-5 col-md-offset-0 col-sm-10 col-sm-offset-1 col-xs-10 col-xs-offset-1">
    <div class="row home-bullets">
      <div><%= image_tag("icons/sd/predictfuture_icon.png")  %><h2>Predict anything.</h2></div>
      <p>What team is winning the big game? Who is the next celeb heading to rehab? When is your best friend getting engaged?</p>
      <div><%= image_tag("icons/sd/settlescore_icon.png") %><h2>Settle the score</h2></div>
      <p>Results are crowdsourced by you, the Knoda community. A BS button allows the community to reverse wrong results.</p>
      <div><%= image_tag("icons/sd/challenge_icon.png") %><h2>Challenge your friends</h2></div>
      <p>Vote on other predictions. Agree if you like the prediction. Disagree and go head-to-head against them if you don’t.</p>
      <div><%= image_tag("icons/sd/talktrash_icon.png") %><h2>Talk some trash</h2></div>
      <p>Comment on any prediction. Have some fun. Hold your friends accountable. Capitalize on your bragging rights.</p>
    </div>  
  </div>
</div>  
<div class="row">
  <div class="col-md-12" style="text-align:center; margin:20px;color:#ffffff">
    <p> The KNODA app is available for free on iPhone and iPad</p>
    <a onclick="ga('send', 'event', 'redirect', 'app_store');" href="https://itunes.apple.com/us/app/knoda/id764642995" target="_blank"><%= image_tag("appStoreBadge.png") %></a>
  </div>
</div>  

<% content_for :bodyClose do %>
  <div class="modal" id="loginModal" tabindex="-1" role="dialog" aria-labelledby="login" aria-hidden="true">
  <div class="modal-dialog">
    <%= form_for(resource, :as => resource_name, :url => session_path(resource_name), :html => {:id => 'login_form'}) do |f| %>
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <div class="modal-title" id="myModalLabel">LOGIN TO KNODA</div>
      </div>
      <div class="modal-body">
            <div class="alert alert-danger" style="display:none">
              <p>Whoa there, we couldn't log you in.  Check your username & password and try again.</p>
            </div>
              <div class="form-group">
                <%= f.text_field :login, :autofocus => true, :class => 'form-control', :placeholder => 'email address or username' %>
              </div>
              <div class="form-group">
                <%= f.password_field :password, :class => 'form-control', :placeholder => 'password'%>
              </div>
              <%= link_to 'forgot password?', new_password_path(:user) %>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        <%= f.submit :value => "Sign In", :class => 'btn btn-success' %>
      </div>
    </div><!-- /.modal-content -->
    <% end %>         
  </div><!-- /.modal-dialog -->     
  </div>

  <script>
  $(function() {
    submitSignup = function(e) {
      e.preventDefault();
      startLoading()
      $.ajax({
        url: "/users.json",
        data: $('#new_user').serialize(),
        type: "POST",
        dataType: "json",
        success: function(json, status) {
          ga('send', 'event', 'users', 'signup');
          window.location = json.location;
        },
        error: function(xhr, status) {
          $('#new_user .alert').show()
          $('#new_user .alert ul').empty();
          for (var x in xhr.responseJSON.errors) {
            $('#new_user .alert ul').append('<li>' + x + ' ' + xhr.responseJSON.errors[x][0]);
          }
        }
      });      
    }    
    $('.signup').on('click', submitSignup);
    $('#new_user').on('submit', submitSignup);
    $('#login_form').on('submit', function(e) {
      e.preventDefault();
      startLoading()
      $.ajax({
        url: "/signin.json",
        data: $('#login_form').serialize(),
        type: "POST",
        success: function(json, status) {
          ga('send', 'event', 'users', 'login');
          window.location = '/predictions'
        },
        error: function(xhr, status) {
          $('#login_form .alert').show()
        }
      });      
    });
  });
  </script>
<% end %>